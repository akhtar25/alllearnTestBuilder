{%extends "layout.html"%} {%block content%}
<div class="container">
    <h2>Class Test Reports</h2>
    <div class="box-body table-responsive no-padding" id="testReportsDiv">

        <table class="table table-hover">
            <tr>
                <th>Class</th>
                <th>Section</th>
                <th>Subject</th>
                <th>Test Date</th>
                <th>Conducted By</th>
                <th>See Report</th>
            </tr>
            {%if testDetailRows | length !=0%}
            {% for eachRow in testDetailRows%}
            <tr style="margin-top:5px;">
                <td><img height="50px"
                        src="https://alllearndatabucketv2.s3.ap-south-1.amazonaws.com/classNumberImages/class{{eachRow.class_val}}.png">
                </td>
                <td>{{eachRow.section}}</td>
                <td>{{eachRow.subject}}</td>
                <td>{{eachRow.test_date.strftime('%d %B %Y')}}</td>
                <td>{{eachRow.conducted_by}}</td>
                <td><input type="button" class="seeTestReportClass btn green" value="See Report" name="{{eachRow.resp_session_id}}"  style="height: 40px; width: 200px;"></td>                
            </tr>
            {% endfor %}

            {%else%}
            <td>
                <h3 class="grey-text">No Class test data available</h3>
                <br>
                <h5>You can create tests and conduct them from using <a href="{{url_for('testBuilder')}}">Test
                        Builder</a></h5>
            </td>
            {%endif%}
        </table>        
    </div>
    <div id="feedbackReportDiv" style="display: none;">        
    </div>
            <input class="btn btn-primary pull-right green" id="backToQuestions" 
    style="height: 40px; width: 200px;display: none;" type="button" value="Back">
</div>

<script>
    
$("#backToQuestions").click(function(){                    
          $("#feedbackReportDiv").hide();         
          $("#backToQuestions").hide();               
          $("#testReportsDiv").show();         
});

  $(".seeTestReportClass").click(function () {
    var resp_session_id = $(this).attr('name');
      $.ajax({
        url: "/feedbackReport?resp_session_id=" +resp_session_id,
        type: "get",
        data: '',   
        beforeSend: function() {                           
                            $("#loaderDiv").show();
                        },
        success: function (response) {
            if (response!='NA'){
          $("#feedbackReportDiv").html(response);          
          
        }
        else{
            $("#feedbackReportDiv").html("<h4 class='grey-text'>No report available for the selection</h4>");
        }
        $("#feedbackReportDiv").show();         
          $("#backToQuestions").show();  
          $("#testReportsDiv").hide();  
                                               
        },
        error: function (xhr) {
          window.alert("error occurred while loading report");
        }
      });    
  });
</script>
{%endblock%}