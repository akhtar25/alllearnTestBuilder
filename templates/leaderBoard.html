{%extends "layout.html"%} {%block content%}
<div class="container">
  <div class="skin-blue sidebar-mini">
    <aside class="main-sidebar" style="margin-top:15px;">
      <!-- sidebar: style can be found in sidebar.less -->
      
      <section class="sidebar">
        <ul class="sidebar-menu" data-widget="tree">
          <li class="treeview menu-open">
            <a href="#">
                <i class="glyphicon glyphicon-education"></i>
              <span>All</span>
            </a>
          </li>
          {% for singleClass in distinctClasses %}
          <li class="treeview">
            <a href="#" class="classDiv" name="{{singleClass[0]}}">
              <i class="glyphicon glyphicon-education"></i>
              <span>Class {{singleClass[0]}}</span>
              <span class="pull-right-container">
                <span class="label label-primary pull-right">{{singleClass[1]}}</span>
              </span>
            </a>
          </li>
          {% endfor %}
          <ul>
      </section>
      <!-- /.sidebar -->
    </aside>
  </div>

  <div class="content-wrapper" style="background-color: white;">
  <div class="box">
    <div class="box-header">
      <h3 class="box-title">Leaderboard for</h3><span style="padding-left: 10px;font-size: 16px;"> Class: <span id="classNo">1</span></span>                             
    </div>
    <form action="" method="POST" enctype="multipart/form-data" style="margin-left: 60px;">
      {{ form.hidden_tag() }}
      <div class="form-group ">
        <div class="row" id="classDetailsDiv">
          <div class="col-sm-2" style="width: 200px;">
            <div>
                {{ form.subject_name.label(class='labelsize') }}
                <div id='loaderSubject' style='display: none; float: right;'>
                    <img src='../static/images/spinner.gif' width='25px' height='25px'>
                </div>
                <br>
                {% if form.subject_name.errors %}
                {{ form.subject_name(class="form-control form-control-lg is-invalid") }}
                <div class="invalid-feedback">
                    {% for error in form.subject_name.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% else %}
                {{ form.subject_name(class='form-control') }}
                {% endif %}
            </div>
        </div>
        <div class="col-sm-2" style="width: 200px;">
          <div>
              {{ form.test_type.label(class='labelsize') }}
              <br>
              {% if form.test_type.errors %}
              {{ form.test_type(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.test_type.errors %}
                  <span>{{ error }}</span>
                  {% endfor %}
              </div>
              {% else %}
              {{ form.test_type(class='form-control') }}
              {% endif %}
          </div>
      </div>
      <div class="col-sm-2" style="width: 200px;">
        <div>
            {{ form.section.label(class='labelsize') }}
            <div id='loaderSection' style='display: none; float: right;'>
                <img src='../static/images/spinner.gif' width='25px' height='25px'>
            </div>
            <br>
            {% if form.section.errors %}
            {{ form.section(class="form-control form-control-lg is-invalid") }}
            <div class="invalid-feedback">
                {% for error in form.section.errors %}
                <span>{{ error }}</span>
                {% endfor %}
            </div>
            {% else %}
            {{ form.section(class='form-control') }}
            {% endif %}
        </div>
    </div>
      </div>
      </form>
  </div>
  <div id="firstTable" class="box-body table-responsive no-padding" style="height:525px;">
      
      <table class="table table-hover">
          
          <thead>
        <tr>
          
         <th>Student</th>
         <th>Class</th>
          <th>Section</th>
          <th>Subject</th>                
          <th>Marks %</th>      
        </tr>
        </thead>
        <tbody>
        {% for eachRow in leaderBoardData%}
        <tr style="margin-top:5px;">
          {% if profile_pic %}
          <td><img src="{{ profile_pic }}" height="50" width="50"> {{eachRow.student_name}}</td>    
          {% else %} 
          <td><img src="https://alllearndatabucketv2.s3.ap-south-1.amazonaws.com/defaultAvatar.png" height="50" width="50"> {{eachRow.student_name}}</td>    
          {% endif %}       
          <td>{{eachRow.class}}</td>
          <td>{{eachRow.section}}</td>
          <td>{{eachRow.subjects}}</td>
          <td>{{eachRow.marks}}</td>                
        </tr>
        {% endfor %}
      </tbody>
      </table>    
    </div>

    <div id="dynamicDataTable">
        <div id="loader" style="display: none;padding-left: 300px;">
            <img src="../static/images/loader.gif">
        </div>
    </div>
  </div>

</div>
<link rel="stylesheet" href="../static/css/skins/_all-skins.min.css">
<script>

var subject_select = document.getElementById('subject_name');
var section_select = document.getElementById('section');
var test_type_select = document.getElementById('test_type');
var optionHTMLTestType = '';
var optionHTMLSubject = '';
var optionHTMLSection = '';
    $(document).ready(function(){
        $('#test_type').val("na");
        optionHTMLTestType += '<option value="na"  selected disabled> All </option>';
        test_type_select.innerHTML = optionHTMLTestType + test_type_select.innerHTML;
        optionHTMLSubject += '<option value="na"  selected disabled> All </option>';
        subject_select.innerHTML = optionHTMLSubject + subject_select.innerHTML;
        optionHTMLSection += '<option value="na"  selected disabled> All </option>';
        section_select.innerHTML = optionHTMLSection + section_select.innerHTML;
    });
var classVal = '';
$('.classDiv').click(function(){
    console.log('inside classDiv');
    classVal = $(this).attr('name');
    var classNo =  classVal;
    $('#classNo').html(classNo)
    console.log('Class:'+classVal);
    optionHTMLTestType += '<option value="na"  selected disabled> All </option>';
        test_type_select.innerHTML = optionHTMLTestType + test_type_select.innerHTML;
    class_val = classVal;
        $("#loaderSubject").show();
        console.log('Inside class value Onchange')
        fetch('/questionBuilder/' + class_val).then(function(response) {
            response.json().then(function(data) {
                    $("#loaderSubject").hide();    
                    var optionHTML = '';
                    optionHTML += '<option value="na"  selected disabled> All </option>';
                    for (var subject of data.subjects) {
                    optionHTML += '<option value="' + subject.subject_id + '">' + subject.subject_name + '</option>';
                }
                subject_select.innerHTML = optionHTML;
            })
            
        });

        $("#loaderSection").show();
        console.log('Inside class value Onchange')
        fetch('/resultUpload/' + class_val).then(function(response) {
                response.json().then(function(data) {
                        $("#loaderSection").hide();    
                        var optionHTML = '';
                        optionHTML += '<option value="na"  selected disabled> All </option>';
                        for (var section of data.sections) {
                        optionHTML += '<option value="' + section.section_val + '">' + section.section_val + '</option>';
                    }
                    section_select.innerHTML = optionHTML;
                })
            });


            $.ajax({  
            url: "/topperList?class_val="+classVal,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
    
});


test_type_select.onchange=function()  {
      class_val = classVal;
 
         subject_id = subject_select.value;

         test_type = test_type_select.value;

         $.ajax({  
            url: "/topperListByTestType?class_val="+class_val+"&subject_id="+subject_id+"&test_type="+test_type,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

subject_select.onchange=function()  {
      class_val = classVal;
 
         subject_id = subject_select.value;

         $.ajax({  
            url: "/topperListBySubject?class_val="+class_val+"&subject_id="+subject_id,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

section_select.onchange=function()  {
      class_val = classVal;
 
         subject_id = subject_select.value;

         test_type = test_type_select.value;

         section_val = section_select.value;

         $.ajax({  
            url: "/topperListBySection?class_val="+class_val+"&subject_id="+subject_id+"&test_type="+test_type+"&section_val="+section_val,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

         
</script>

{% endblock %}