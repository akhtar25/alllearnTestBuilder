{%extends "layout.html"%} {%block content%}
<div class="container">
  <div class="skin-blue sidebar-mini">
    <aside class="main-sidebar">
      <!-- sidebar: style can be found in sidebar.less -->
      
      <section class="sidebar">
        <ul class="sidebar-menu" data-widget="tree">
          <li class="treeview menu-open">
            <a href="#" class="class_div">
                <i class="glyphicon glyphicon-education"></i>
              <span>All</span>
            </a>
          </li>
          {% for singleClass in distinctClasses %}
          <li class="treeview">
            <a href="#" class="classDiv" name="{{singleClass[0]}}">
              <i class="glyphicon glyphicon-education"></i>
              <span>Class {{singleClass[0]}}</span>
              <span class="pull-right-container">
                <span class="label label-primary pull-right">{{singleClass[1]}}</span>
              </span>
            </a>
          </li>
          {% endfor %}
          <ul>
      </section>
      <!-- /.sidebar -->
    </aside>
  </div>

  <div class="content-wrapper" style="background-color: white;">
  <div class="box">
    <div class="box-header">
      <h3 class="box-title">Leaderboard for</h3><span style="padding-left: 10px;font-size: 16px;"> Class: <span id="classNo">1</span></span>                             
    </div>
    <form action="" method="POST" enctype="multipart/form-data" style="margin-left: 60px;">
      {{ form.hidden_tag() }}
      <div class="form-group ">
        <div class="row" id="classDetailsDiv">
          <div class="col-sm-2" style="width: 200px;">
            <div>
                {{ form.subject_name.label(class='labelsize') }}
                <div id='loaderSubject' style='display: none; float: right;'>
                    <img src='../static/images/spinner.gif' width='25px' height='25px'>
                </div>
                <br>
                {% if form.subject_name.errors %}
                {{ form.subject_name(class="form-control form-control-lg is-invalid") }}
                <div class="invalid-feedback">
                    {% for error in form.subject_name.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% else %}
                {{ form.subject_name(class='form-control') }}
                {% endif %}
            </div>
        </div>
        <div class="col-sm-2" style="width: 200px;">
          <div>
              {{ form.test_type.label(class='labelsize') }}
              <br>
              {% if form.test_type.errors %}
              {{ form.test_type(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.test_type.errors %}
                  <span>{{ error }}</span>
                  {% endfor %}
              </div>
              {% else %}
              {{ form.test_type(class='form-control') }}
              {% endif %}
          </div>
      </div>
      <div class="col-sm-2" id="sectionDiv" style="width: 200px;display:none;">
        <div>
            {{ form.section.label(class='labelsize') }}
            <div id='loaderSection' style='display: none; float: right;'>
                <img src='../static/images/spinner.gif' width='25px' height='25px'>
            </div>
            <br>
            {% if form.section.errors %}
            {{ form.section(class="form-control form-control-lg is-invalid") }}
            <div class="invalid-feedback">
                {% for error in form.section.errors %}
                <span>{{ error }}</span>
                {% endfor %}
            </div>
            {% else %}
            {{ form.section(class='form-control') }}
            {% endif %}
        </div>
    </div>
    <!-- Drop down for Test Date -->
    <div class="col-sm-2" id="testdateDiv" style="width: 200px;display:none;">
        <div>
            {{ form.testdate.label(class='labelsize') }}
            <div id='loaderTestDate' style='display: none; float: right;'>
                <img src='../static/images/spinner.gif' width='25px' height='25px'>
            </div>
            <br>
            {% if form.testdate.errors %}
            {{ form.testdate(class="form-control form-control-lg is-invalid") }}
            <div class="invalid-feedback">
                {% for error in form.testdate.errors %}
                <span>{{ error }}</span>
                {% endfor %}
            </div>
            {% else %}
            {{ form.testdate(class='form-control') }}
            {% endif %}
        </div>
    </div>
      </div>
      </form>
  </div>
  <div id="firstTable" class="box-body table-responsive no-padding" style="height:500px;">
      
      <table class="table table-hover">
          
          <thead>
        <tr>
          
         <th>Student</th>
         <th>Class</th>
          <th>Section</th>
          <th>Subject</th>                
          <th>Marks %</th>      
        </tr>
        </thead>
        <tbody>
        {% if leaderBoardData %}  
        {% for eachRow in leaderBoardData%}
        <tr style="margin-top:5px;">
          {% if profile_pic %}
          <td style="text-align: center;width:250px;" ><img src="{{ profile_pic }}" height="50" width="50"><span style="text-align: center;"> {{eachRow.student_name}}</span></td>    
          {% else %} 
          <td style="text-align: center;width: 250px;">
            <img src="https://alllearndatabucketv2.s3.ap-south-1.amazonaws.com/defaultAvatar.png" height="50" width="50">
            <span style="text-align: center;"> {{eachRow.student_name}}</span>
          </td>    
          {% endif %}       
          <td>{{eachRow.class}}</td>
          <td>{{eachRow.section}}</td>
          <td>{{eachRow.subjects}}</td>
          <td>{{eachRow.marks}}</td>                
        </tr>
        {% endfor %}
        {% else %}
        <tr>
        <td colspan="5"><span class="grey-text text-lighten-1"><p style="font-size: 15px;text-align: center;">No data found</p></span></td>
      </tr>
        {% endif %}
      </tbody>
      </table>    
    </div>
    
    <div class="tableDynamic">
    <div id="dynamicDataTable">
        
    </div>
    <div id="loader" style="display: none;padding-left: 300px;padding-top: 150px;padding-bottom: 250px;">
        <img src="../static/images/loader.gif">
    </div>
  </div>
  </div>

</div>
<link rel="stylesheet" href="../static/css/skins/_all-skins.min.css">
<script>

var subject_select = document.getElementById('subject_name');
var section_select = document.getElementById('section');
var test_type_select = document.getElementById('test_type');
var test_date_select = document.getElementById('testdate');
var optionHTMLTestType = '';
var optionHTMLSubject = '';
var optionHTMLSection = '';
var optionHTMLTestDate = '';
    $(document).ready(function(){
        optionHTMLTestType += '<option value="All"  selected> All </option>';
        test_type_select.innerHTML = optionHTMLTestType + test_type_select.innerHTML;
        optionHTMLSubject += '<option value="All"  selected> All </option>';
        subject_select.innerHTML = optionHTMLSubject + subject_select.innerHTML;
        optionHTMLSection += '<option value="All"  selected> All </option>';
        section_select.innerHTML = optionHTMLSection + section_select.innerHTML;
        optionHTMLTestDate += '<option value="All"  selected> All </option>';
        test_date_select.innerHTML = optionHTMLTestDate + test_date_select.innerHTML;
        $('#classNo').html('All');
    });
var classVal = '';




$('.class_div').click(function(){
  $('#sectionDiv').hide();
  $('#testdateDiv').hide();
  $('#classNo').html('All');
  document.getElementById('test_type').value = "All";
  document.getElementById('section').value = "All";
  document.getElementById('subject_name').value = "All";
  document.getElementById('testdate').value = "All";
  $.ajax({  
            url: "/topperListAll",
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#dynamicDataTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
});
$('.classDiv').click(function(){
    console.log('inside classDiv');
    $('#sectionDiv').show();
    $('#testdateDiv').show();
    document.getElementById('test_type').value = "All";
    document.getElementById('section').value = "All";
    document.getElementById('subject_name').value = "All";
    document.getElementById("testdate").value = "All";
    $('#test_type').val('All');
    $('#section').val('All');
    $('#subject_name').val('All');
    $('#testdate').val('All');
    classVal = $(this).attr('name');
    var classNo =  classVal;
    $('#classNo').html(classNo)
    console.log('Class:'+classVal);
    class_val = classVal;
        $("#loaderSubject").show();
        console.log('Inside class value Onchange')
        fetch('/questionBuilder/' + class_val).then(function(response) {
            response.json().then(function(data) {
                    $("#loaderSubject").hide();    
                    var optionHTML = '';
                    optionHTML += '<option value="All"  selected> All </option>';
                    for (var subject of data.subjects) {
                    optionHTML += '<option value="' + subject.subject_id + '">' + subject.subject_name + '</option>';
                }
                subject_select.innerHTML = optionHTML;
            })
            
        });

        $("#loaderSection").show();
        console.log('Inside Section value Onchange')
        fetch('/resultUpload/' + class_val).then(function(response) {
                response.json().then(function(data) {
                        $("#loaderSection").hide();    
                        var optionHTML = '';
                        optionHTML += '<option value="All"  selected> All </option>';
                        for (var section of data.sections) {
                        optionHTML += '<option value="' + section.section_val + '">' + section.section_val + '</option>';
                    }
                    section_select.innerHTML = optionHTML;
                })
            });

            $("#loaderTestDate").show();
        console.log('Inside Test Date Onchange')
        fetch('/testDateSearch/' + class_val).then(function(response) {
                response.json().then(function(data) {
                        console.log('inside fetch data of test date');
                        $("#loaderTestDate").hide();    
                        var optionHTML = '';
                        optionHTML += '<option value="All"  selected> All </option>';
                        for (var testdate of data.testdates) {
                        optionHTML += '<option value="' + testdate.date + '">' + testdate.date + '</option>';
                    }
                    test_date_select.innerHTML = optionHTML;
                })
            });


            var subject_id = $('#subject_name').val();
            var test_type = $('#test_type').val();
            var section_val = $('#section').val();
            var test_date = $('#testdate').val();
            $.ajax({  
            url: "/topperList?class_val="+classVal+"&subject_id="+subject_id+"&test_type="+test_type+"&section_val="+section_val+'&test_date='+test_date,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#dynamicDataTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
    
});


test_type_select.onchange=function()  {
    console.log('Inside test type change');
      class_val = classVal;
         test_date = test_date_select.value;
         subject_id = subject_select.value;
         section_val = section_select.value;
         test_type = test_type_select.value;

         $.ajax({  
            url: "/topperListForAll?class_val="+class_val+"&subject_id="+subject_id+"&test_type="+test_type+"&section_val="+section_val+'&test_date='+test_date,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#dynamicDataTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

subject_select.onchange=function()  {
      class_val = classVal;
 
         subject_id = subject_select.value;
         section_val = section_select.value;
         test_type = test_type_select.value;
         test_date = test_date_select.value;
         $.ajax({  
            url: "/topperListForAll?class_val="+class_val+"&subject_id="+subject_id+"&test_type="+test_type+"&section_val="+section_val+"&test_date="+test_date,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#firstTable').hide();
                $('#dynamicDataTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

section_select.onchange=function()  {
         class_val = classVal;
 
         subject_id = subject_select.value;

         test_type = test_type_select.value;

         section_val = section_select.value;

         test_date = test_date_select.value;

         $.ajax({  
            url: "/topperListForAll?class_val="+class_val+"&subject_id="+subject_id+"&test_type="+test_type+"&section_val="+section_val+"&test_date="+test_date,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#dynamicDataTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

test_date_select.onchange=function()  {
         class_val = classVal;
 
         subject_id = subject_select.value;

         test_type = test_type_select.value;

         section_val = section_select.value;

         test_date = test_date_select.value;

         $.ajax({  
            url: "/topperListForAll?class_val="+class_val+"&subject_id="+subject_id+"&test_type="+test_type+"&section_val="+section_val+"&test_date="+test_date,
            type: "get",
            data: "",            
            beforeSend: function() { 
                $('#dynamicDataTable').hide();
                $('#loader').show();
           },
            success: function (response) {
              $('#loader').hide();
              $('#dynamicDataTable').html(response);
              $('#dynamicDataTable').show();
            },
            error: function (xhr) {
                window.alert("error occurred while loading question");
            }
        });
}

         
</script>

{% endblock %}