{%extends "layout.html"%} {%block content%}
<div class="container" height=100% >
        
    
    <div class="skin-blue sidebar-mini">
        
    
        <aside class="main-sidebar" style="margin-top:15px;">
            <!-- sidebar: style can be found in sidebar.less -->
            
            <section class="sidebar">                     
              <ul class="sidebar-menu" data-widget="tree">
                  {% for singleClass in distinctClasses %}
                         <li class="treeview">
                           <a href="#">
                             <i class="glyphicon glyphicon-education"></i>
                             <span>Class {{singleClass[0]}}</span>
                             <span class="pull-right-container">
                               <span class="label label-primary pull-right">{{singleClass[1]}}</span>
                             </span>
                           </a>                                                      
                           <ul class="treeview-menu">                            
                              {% for classsection in classSections %}
                                 {% if classsection.class_val==singleClass[0] %}
                             <li><a href="{{ url_for('classCon',class_val=classsection.class_val, section=classsection.section) }}"><i class="fa fa-circle-o"></i> Section {{classsection.section}}</a></li>                              
                              {% endif %}
                             {% endfor %}
                           </ul>
                                                      
                         </li>
                         {% endfor %}                
         <ul>
         
         
        </section>
                
            </aside>
        
        
            <!--------------------------------------------------------------------------------------------->
            <div class="content-wrapper" style="background-color: white;">
    <section class="content">
        <div class="row">
                <div class="row">
                <div class="col-xs-8"  >
                  <div class="box" id="feedbackQuestionDiv">
                    <div class="box-header" >
                      <h3 class="box-title">Feedback questions </h3><span style="padding-left: 10px;">    Class: {{ class_val }} | Section: {{ section }}</span>        
                      
                    </div>
                    
                       
                    <span id="questionList" style="display: none;">{{ questionList }}</span>
                    <input id="current_question_id" style="display: none;">
                    <input id="class_val_ip" style="display: none;" type="text" value="{{class_val}}">
                    <input id="section_ip" style="display: none;"type="text" value="{{section}}">
                    <input id="questionListSize" value="{{ questionListSize }}" style="display: none;" type="text">

                    <div id = "questionSection">        
                      <div id="questionPlaceholder">
                        <br>
                        <br>
                        <br>
                        
                      <p style="font-size: 48px;" class="grey-text text-lighten-1">Click Start to load questions</p>
                    </div>
                    </div>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
                    <input type="button" value="Start" class="btn btn-primary pull-right" id="startAndNextBTN" style="height: 40px; width: 200px;">
                    <input type="button" value="Take Response" class="btn green btn-primary" id="recordResponsesBTN" style="height: 40px; display: none; ">
                  
                      
                      <input type="button" value="Stop" class="btn red lighten-1" id="stopRecordingBTN" style="height: 40px; display: none; ">
                
                 
                    <input type="button" value="Finish" class="btn btn-primary pull-right" id="submitAndFinishBTN" style="height: 40px; width: 200px;display: none;">
                  </div>

                  <div  class="box" id="feedbackReportDiv" style="display: none;">

                  
                  </div>
                
                </div>
                

                  <div class="col-md-3" style="margin-top:20px;">
                    <div id="answerCounter" style="overflow-y: auto; height:200px;">
                      
                    <h4>Response Summary</h4> 
                    <div id="ResponseList">
                
                        <form id="responseForm">
                    <div id="result_strip">
                        <ul class="thumbnails"></ul>
                    </div>
                    <div id="questionListSizeDiv">
                      
                      </div>
                    </form>
                    </div>
                    <div id="allResponsesSubmitted" style="display: none;">All Responses Submitted</div>
                    
                </div>
                
                <div style="background-color:white; height: 250; width:350px;">
                
        
               <div class="video-field" id="video-field">
                
                <div class="select">
                    <label for="videoSource"></label><select id="videoSource"></select>
                </div>
                <video id="video" muted autoplay></video>
             
             
            </div>
            
                  </div>
              
                </div>
              </div>
        </div>
        
    </section>
</div>
    </div>
        </div>    
        <!--New Div for the updated camera mechanism-->
        <div id="container">            
            <div class="">
                <label for="audioSource"></label><select id="audioSource"></select>
            </div>
            



            <canvas id="canvas" class="drawingBuffer" style="display:none !important"></canvas><br clear="all">

        </div>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

         
            
        </div>

        <link rel="stylesheet" href="../static/css/skins/_all-skins.min.css">
        <script>
          var subject_id = {{subject_id}};
              var questionIDListJS = [];
              {%  for question in questionList%}              
              questionIDListJS.push({{question.question_id}});
              {% endfor %}

              var questionListSize = {{ questionListSize }};
              var tempCountVar = 0;

            $("#startAndNextBTN").click(function(){
              keepRecording = true;   

                if(tempCountVar<questionListSize){
                  $('#current_question_id').val(questionIDListJS[tempCountVar]); 
                $.ajax({
                  url: "/loadQuestion?qnum="+ tempCountVar+"&total="+questionListSize ,
                  type: "get",
                  data: {question_id: questionIDListJS[tempCountVar]},
                  success: function(response) {       
                    $("#questionSection").html(response);                    
                    tempCountVar= tempCountVar+1;                
                    if(tempCountVar==questionListSize){
                      $("#startAndNextBTN").hide();                      
                      $("#recordResponsesBTN").show();
                    }
                    else{
                      $("#startAndNextBTN").attr('value','Next');       
                      $("#startAndNextBTN").hide();
                      $("#recordResponsesBTN").show();                                         
                    }
                  },
                  error: function(xhr) {
                    window.alert("error occurred while loading question");
                  }
                });
              }
              else{

              }
            });

            $('#submitAndFinishBTN').click(function(){     
              var class_val = $('#class_val_ip').val();
              console.log('This is the class_val in js: ' + class_val);
              var section = $('#section_ip').val();
              console.log('This is the section: ' + section);
              questionIDListStr  = JSON.stringify(questionIDListJS);                       
                $.ajax({
                  url: "/feedbackReport",
                  type: "get",
                  data: {question_id: questionIDListStr,
                        class_val: class_val,
                        section: section,
                         subject_id:subject_id},
                  success: function(response) {
                    $("#feedbackReportDiv").show(); 
                    $("#feedbackReportDiv").html(response);        
                    $("#feedbackQuestionDiv").hide();
                    $("#video-field").hide();                    
                    $("#ResponseList").hide();                    
                    $("#allResponsesSubmitted").show();              
                  },
                  error: function(xhr) {
                    window.alert("error occurred while loading question");
                  }
                });              
            });
            </script>
            <script src="../static/js/main.js"></script>

{%endblock%}
        