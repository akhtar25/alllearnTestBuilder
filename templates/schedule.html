{%extends "layout.html"%} {%block content%}

<div class="container">
  <div class="row">
    <h3>Schedule Details</h3>
    <h5>
        <form action="" method="POST" enctype="multipart/form-data">
        <form id="timeTableForm">
            <div class="form-group " style="padding-top:5px;">
            <div class="row">
            <div class="slots" style="display: flex;">
            
            <div style="margin-left:15px;">
              <div class="col-sm-3">
                <div style="width:115px;">
                    {{ form1.class_val.label(class='labelsize') }}
                    <br>
                    {% if form1.class_val.errors %}
                    {{ form1.class_val(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form1.class_val.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form1.class_val(class='form-control',id='classVal') }}
                    {% endif %}
                </div>
            </div>
            </div>
            <div style="margin-left:68px;width:180px;">
              <label>No Of Slots:</label>
              <input type="number" id="slots" onKeyPress="return false;" name="slots" style="width:50px;"/></br>
          </div>
          <!-- <div style="width:165px;">
            <label>No of Sections:</label>
            <input type="text" id="batches" name="batches" style="width:50px;"/></br>
        </div> -->
        <div style="width:230px;">
            <label>No of Days (per week)</label>
            <input type="number" id="nDays" name="nDays" onKeyPress="return false;" min="1" max="6" style="width:50px;"/></br>
        </div>
        <!-- <div>
          <label>No of Teachers</label>
          <input type="text" id="noTeachers" name="noTeachers" style="width:50px;"/></br>
        </div> -->
        
      </div>
          </div>
          <div style="display: flex;">
            <div class="subjectDetails" style="width:210px;">
              <ul id="addSubTime">
              
            </ul>
          </div>
            <div class="Time" style="width: 177px;">
            </div>
            <div class="noOfDays" style="margin-left:15px;">
                
                <p>
                    <label>
                      <input type="checkbox" name="day" value="Monday" />
                      <span>Monday</span>
                    </label>
                  </p>
                  <p>
                    <label>
                      <input type="checkbox" name="day" value="Tuesday" />
                      <span>Tuesday</span>
                    </label>
                  </p>
                  <p>
                    <label>
                      <input type="checkbox" name="day" value="Wednesday" />
                      <span>Wednesday</span>
                    </label>
                  </p>
                  <p>
                    <label>
                      <input type="checkbox" name="day" value="Thursday" />
                      <span>Thursday</span>
                    </label>
                  </p>
                  <p>
                    <label>
                      <input type="checkbox" name="day" value="Friday" />
                      <span>Friday</span>
                    </label>
                  </p>
                  <p>
                    <label>
                      <input type="checkbox" name="day" value="Saturday" />
                      <span>Saturday</span>
                    </label>
                  </p>
            </div>
            
            
          
            <div class="button" style="text-align: right;margin-top: 240px;">
                <button class="btn waves-light green lighten-1 white-text" id="submit" value="submit">Confirm</button>
            </div>
        </div>
        </div>
      </form>
</form>
   
  </div>
  <div class="row">
    <div class="col-sm-2">
      <div style="width:150px;">
        {{ form.class_section.label(class='labelsize') }}
        <br>
        {% if form.class_section.errors %}
        {{ form.class_section(class="form-control form-control-lg is-invalid") }}
        <div class="invalid-feedback">
            {% for error in form.class_section.errors %}
            <span>{{ error }}</span>
            {% endfor %}
        </div>
        {% else %}
        {{ form.class_section(class='form-control') }}
        {% endif %}
      </div>
      <input type='hidden' name='checkIndx' id='checkIndx' />
  </div> 
  
  </div>
  <div class="row">
    <div id="timeTableDiv">

    </div>
  </div>
</div>

<script>
  var class_section = document.getElementById('class_section');
  classSection = class_section.value;
  var res = classSection.split("-");
  var class_val = res[0];
  var section = res[1];
  class_section.onchange = function(){
    console.log('inside function of class section');
    $.ajax({
            url: "/fetchTimeTable?class_value=" + class_val+"&section="+section,
            type: "get",
            data: "",
            success: function (response) {
              $('#timeTableDiv').html(response);
            },
            error: function (xhr) {
                window.alert("error occurred while fetching timetable");
            }
        });
  };

  $("#slots").blur(function(){
  var slots = $('#slots').val();
  var input = '';
  for(var i=0;i<slots;i++){
    input = input + '<label>Start:</label><input type="text" name="start" id="start1" style="width:50px;"/><label>End:</label><input type="text" name="end" id="end1" style="width:50px;"/></br>'
  }
  $('.Time').html(input);
});

// $("#slots").attr({
//    "max" : maxSub,
//    "min" : 1
// });

var class_select = document.getElementById("classVal");
var maxSub = '';
var optionHTMLClass = '';
    $(document).ready(function(){
        $('#classVal').val("na");
        console.log("CLass Value:"+class_select.value);
        optionHTMLClass += '<option value="na"  selected disabled> Select Class </option>';
        class_select.innerHTML = optionHTMLClass + class_select.innerHTML;
    });
class_select.onchange = function(){
  var class_v = class_select.value;
    console.log('inside class_val onchange');
    console.log('class'+class_v);
    $.ajax({
            url: "/allSubjects?class_value=" + class_v,
            type: "get",
            data: "",
            success: function (response) {
              subTimeHtml = '';  
              console.log(response);  
              responseArr = response.toString().split(',');
              maxSub = responseArr.length;
              $("#slots").attr({
                  "max" : maxSub,
                  "min" : 1
              });
              for(var i=0;i<responseArr.length;i++){
                
                console.log(responseArr[i]);
                subTimeHtml = subTimeHtml+ '<li><label>Time(hr)</label><input type="number" onKeyPress="return false;" id="time1" min="1" max="'+maxSub+'" name="time" style="width:50px;"/><label style="margin-left:15px;">'+responseArr[i]+'</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="hidden" id="subject1" value="'+responseArr[i]+'" name="subject" style="width:50px;" /></li>';
              }
              $('#addSubTime').html(subTimeHtml);
            },
            error: function (xhr) {
                window.alert("error occurred while fetching subjects list");
            }
        });
  };


// $(document).ready(function(){
//     $('select').formSelect();
//   });

  $('#submit').click(function(){
    $e.preventDefault(); 
    var form = $('#timeTableForm');  
    $.ajax({
            url: "/schedule",
            type: "POST",
            data: form.serialize(),
            success: function (formResponse) { 
              
           
            },
            error: function (xhr) {
              $('#errorMSGSpan').html('Error in creating timetable Please try again.');  
            }
        });
  });


</script>

{% endblock %}