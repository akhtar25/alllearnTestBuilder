{%extends "layout.html"%} {%block content%}
<div class="container" height=100%>


  <div class="sidebar-mini"> 
     <aside class="main-sidebar" style="padding:0px;">            
            <section class="sidebar" id="leftPanel" style="display: none;">
              <div id="timeDiv">
              <h4>Remaining Time:<span id="remTime"></span></h4>
            </div>
              <!-- panel -->
              <div class="panel panel-body panel-default mb0 mt10" style="border:dotted;padding: 0px;">
                <div class="table-responsive">
                  <table class="table table-borderless mb0">
                    <thead>
                      <tr>
                        <td class="full-width" style="font-size: 23px;"><a class="test-ques-stats que-not-answered lblNotAttempted" style="background: url('https://data.nta.ac.in/img/QuizIcons/Logo1.png');font-size: 23;">10</a></td>
                        <td>Not Answered</td>
                        <td class="full-width" style="font-size: 23px;"><a class="test-ques-stats que-not-answered lblNotAttempted" style="background: url('https://data.nta.ac.in/img/QuizIcons/Logo3.png');font-size: 23;">10</a></td>
                        <td>Answered</td>
                      </tr>
                      <tr>
                        <td class="full-width"  style="font-size: 23px;"><a class="test-ques-stats que-not-answered lblNotAttempted" style="background: url('https://data.nta.ac.in/img/QuizIcons/Logo4.png');font-size: 23;">10</a></td>
                        <td>Marked for review</td>
                        <td class="full-width"  style="font-size: 23px;"><a class="test-ques-stats que-not-answered lblNotAttempted" style="background: url('https://data.nta.ac.in/img/QuizIcons/Logo5.png');font-size: 23;">10</a></td>
                        <td>Answered and marked for review</td>
                      </tr>
                    </thead>
                  </table>
                </div>
              </div>
              <!-- End -->
              <div class="panel panel-default">
                <div class="panel-body" style="height:300px;overflow-y:scroll;">
                  <ul class="pagination test-questions">

                    {% for row in questionList %}
                    <li class="active" data-seq="1">

                      <!-- <a href="javascript:void(0);" id="{{row.question_id}}" class="test-ques que-not-answered" style="background: url('https://data.nta.ac.in/img/QuizIcons/Logo3.png');margin-left: 2px;background-color: #ddd;color: black;cursor: pointer;" data-href="" onclick="fetchSubmitQuestion('{{loop.index-1}}','skip');">{{loop.index}}</a> -->
                      
                      <a href="javascript:void(0);" id="{{row.question_id}}" class="test-ques que-not-answered" style="margin-left: 2px;background-color: #ddd;color: black;cursor: pointer;" data-href="" onclick="fetchSubmitQuestion('{{loop.index-1}}','skip');">{{loop.index}}</a>
                    </li>
                    {% endfor %}
                    <!-- <li class="active" data-seq="1">
                      <a href="javascript:void(0);" class="test-ques que-not-answered" style="margin-left: 2px;" data-href="">02</a>
                    </li>
                    <li class="active" data-seq="1">
                      <a href="javascript:void(0);" class="test-ques que-not-answered" style="margin-left: 2px;" data-href="">03</a>
                    </li>
                    <li class="active" data-seq="1">
                      <a href="javascript:void(0);" class="test-ques que-not-answered" style="margin-left: 2px;" data-href="">04</a>
                    </li>
                    <li class="active" data-seq="1">
                      <a href="javascript:void(0);" class="test-ques que-not-answered" style="margin-left: 2px;" data-href="">05</a>
                    </li> -->
                  </ul>
                </div>
              </div>                    
              <!-- <ul class="sidebar-menu" data-widget="tree">
                  {% for singleClass in distinctClasses %}
                         <li class="treeview">
                           <a href="#">
                             <i class="glyphicon glyphicon-education"></i>
                             <span>Class {{singleClass[0]}}</span>
                             <span class="pull-right-container">
                               <span class="label label-primary pull-right">{{singleClass[1]}}</span>
                             </span>
                           </a>                                                      
                           <ul class="treeview-menu">                            
                              {% for classsection in classSections %}
                                 {% if classsection.class_val==singleClass[0] %}
                             <li><a href="{{ url_for('classCon',class_val=classsection.class_val, section=classsection.section) }}"><i class="fa fa-circle-o"></i> Section {{classsection.section}}</a></li>                              
                              {% endif %}
                             {% endfor %}
                           </ul>                                                      
                         </li>
                         {% endfor %}                
         <ul>                   -->
        </section>                
            </aside>        
    <!--------------------------------------------------------------------------------------------->
    <div class="content-wrapper" style="background-color: white;">
      <section class="content">
        <div class="row">
          <div class="row">
            <div class="col-xs-8" style="width:100%;">
              <div class="box" id="feedbackQuestionDiv">
                <div class="box-header">
                  <h3 class="box-title">{{test_type}} </h3><span style="padding-left: 10px;"> Class:
                    {{ class_val }} | Section: {{ section }}</span>
                </div>
                <span id="questionList" style="display: none;">{{ questionList }}</span>
                <input id="currrent_question_id" style="display: none;">
                <input id="class_val_ip" style="display: none;" type="text" value="{{class_val}}">
                <input id="section_ip" style="display: none;" type="text" value="{{section}}">
                <input id="questionListSize" value="{{ questionListSize }}" style="display: none;" type="text">
                <div id="questionSection">
                  <div id="questionPlaceholder">
                    <br>
                    <br>
                    <br>
                    {% if questionList|length > 0 %}
                    <p style="font-size: 48px;line-height: inherit;" class="grey-text text-lighten-1">Click Start to load questions</p>
                    <br><br><br><br><br><br><br><br>

                    {%else %}
                    <p style="font-size: 48px;" class="grey-text text-lighten-1">No questions under <br><br>the selected
                      topic(s)</p>
                    {% endif %}
                  </div>
                </div>
                <div id="questionButtons">
                  {% if questionList|length > 0 %}
                  <div class="NewBtn">
                    <!-- Add more buttons -->
                    <a id="clear" style="display:none;margin-left:30px;cursor: pointer;float: left;font-size: 18px;margin-top: 8px;">Clear</a>
                    <!-- <input type="button" value="Clear" class="btn btn-primary left" id="clear"
                    style="height: 40px; width: 100px;margin-left:15px;margin-left: 30px;display:none;color: black;background-color: white;"> -->
                    <input type="button" value="Start" class="btn btn-primary pull-right green" id="start" onclick="fetchSubmitQuestion('q','Start');"
                    style="height: 40px; width: 200px;margin-left: 30px;">
                    <input type="button" value="Submit and next" class="btn btn-primary left green" id="startAndNextBTN" onclick="fetchSubmitQuestion('q','submitandnext');"
                    style="height: 40px; width: 200px;margin-left: 30px;display:none;">
                    <input type="button" value="Mark for review and submit" class="btn btn-primary left" id="save" onclick="fetchSubmitQuestion('q','save');"
                    style="height: 40px; width: 238px;margin-left:15px;margin-left: 30px;display:none;background-color: #f0ad4e;">
                    <input type="button" value="Mark for review and next" class="btn btn-primary left" id="next" onclick="fetchSubmitQuestion('q','next');"
                    style="height: 40px; width: 220px;margin-left:15px;margin-left: 30px;display:none;">
                  </div>
                  {% endif %}
                  <!-- <input type="button" value="Skip" class="btn btn-primary left" id="skipButton"
                  style="height: 40px; width: 150px;display:none;margin-top: 20px;color: black;background-color: white;" onclick="fetchSubmitQuestion('q');"> -->
                  <input type="button" value="Submit and End Test" class="btn btn-primary pull-right green" id="submit" onclick="fetchSubmitQuestion('q','submit');"
                  style="height: 40px; width: 200px;display:none;margin-top: 20px;">
                  <input type="button" value="Submit and End Test" class="btn btn-primary pull-right green" id="timeout" onclick="fetchSubmitQuestion('q','timeout');"
                  style="height: 40px; width: 200px;display:none;margin-top: 20px;">
                  <!-- <a id="skipButton" style="display:none;float:right;margin-right:5px;cursor: pointer;">Skip</a> -->

                  <!--<input type="button" value="Take Response" class="btn green btn-primary" id="startrecordResponsesBTN" style="height: 40px; display: none; ">  -->
                  <!--<input type="button" value="Stop" class="btn red lighten-1" id="stopRecordingBTN"
                    style="height: 40px; display: none; ">-->
                  <!--<input type="button" value="Finish" class="btn btn-primary pull-right" id="submitAndFinishBTN"
                    style="height: 40px; width: 200px;display: none;">-->
                </div>
              </div>
              <div class="box" id="feedbackReportDiv" style="display: none;">
              </div>
              <a class="btn btn-primary" id="completeClassBTN" href="{{url_for('classCon')}}"
                style="display: none;">Complete Class</a>
            </div>
            <!-- <div class="col-md-3" style="margin-top:20px;">
                    <div id="answerCounter" style="overflow-y: auto; height:200px;">
                    <h4>Response Summary</h4> 
                    <div id="errorMsgElement"></div>
                      <div id="ResponseList">                
                        <form id="responseForm">
                          <div id="result_strip">
                        <ul class="thumbnails"></ul>
                          </div>
                            <div id="questionListSizeDiv">                      
                           </div>
                        </form>
                      </div>
                    <div id="allResponsesSubmitted" style="display: none;">All Responses Submitted</div>                    
                </div>                                                
                <div >                                       
               <div class="video-field" id="video-field">                
               <video id="video" height="300" muted autoplay></video>                     
               <canvas id="piccanvas" width="640" height="480" style="display:none !important"></canvas>
               </div>                  
                  </div>            
                </div>-->
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>                 -->
</div>
<link rel="stylesheet" href="../static/css/skins/_all-skins.min.css">
<script>
  //var subject_id = {{subject_id}};
  var questionIDListJS = []; {%for question in questionList %}
  // this is my name
  questionIDListJS.push({{question.question_id}}); 
  {% endfor %}
  var questionListSize = {{questionListSize}};

  var tempCountVar = 0;
  $("#startrecordResponsesBTN").click(function () {
    $("#skipButton").hide();
  });

  // $("#skipButton").click(function () {
  //   document.getElementById("startAndNextBTN").click();
  // });

  // $("#skipButton").click(function () {
  //   document.getElementById("startAndNextBTN").click();
  // });


  //$(".ansOption").click(function () {
  //  alert('This is the option');
  //});



    var c = 0;
    var j=0;
  
  var clearBtn = document.getElementById('clear');
  clearBtn.addEventListener('click',function(){
    $('#startAndNextBTN').prop('disabled',true);
    $('#save').prop('disabled',true);
  });
  function fetchSubmitQuestion(num,btn) {
    
    $('#leftPanel').show();
    $('#startAndNextBTN').show();
    $('#save').show();
    $('#next').show();
    $('#clear').show();
    $('#submit').show();
    if(btn=='submit'||btn=='timeout'){
    $('#startAndNextBTN').hide();
    $('#save').hide();
    $('#leftPanel').hide();
    $('#next').hide();
    $('#clear').hide();
    $('#submit').hide();
    }
    
    // $("#startAndNextBTN").attr("disabled", true);
    $('#start').hide();

    $("#currrent_question_id").val(questionIDListJS[tempCountVar]);

    var radioValue = $("input[name='ansOption']:checked").val();
    var respOption = '';
    if (radioValue) {
      respOption =radioValue; 
    }
    if (tempCountVar <= questionListSize) {  
      var lastQIDVal = ''; 
      var valueQ = $("#lastQIDVal").val(); 
      if(valueQ){
        lastQIDVal = valueQ
      }
      resp_sessId = "{{resp_session_id}}"; 
      console.log('Resp_session_id:'+resp_sessId);  
      var obj = JSON.parse('{ "resp_sessId":"{{resp_session_id}}"}');  
      //alert("qnum:" + tempCountVar + "&total=" + questionListSize + "&question_id=" +
      //    questionIDListJS[tempCountVar] + "&response_option="+ respOption+ "&resp_session_id="+ {{resp_session_id}}+
      //    "&subject_id="+ {{subject_id}}+"&last_q_id="+lastQIDVal);
      var qcount = '';
      console.log('Num:'+num)
      if(num=='q'){
        console.log('inside if:'+num);
        if(btn=='Start'){
          
            tempCountVar = parseInt(c);            
               
        }else
        {
          if(c==j){
            console.log('if coming from numpad');
            tempCountVar = (parseInt(c)+1);
            c = (parseInt(c)+1);
          }else{
        tempCountVar = (parseInt(c));
        console.log('c:'+(parseInt(c)));
          }
        }
        qcount = questionIDListJS[tempCountVar];
      }else{
        tempCountVar = num;
        c = num;
        j=num;
        console.log('inside else:'+num);
        qcount = questionIDListJS[parseInt(num)];
      }
      $.ajax({
        url: "/loadQuestionStud?qnum=" + tempCountVar + "&total=" + questionListSize + "&question_id=" +
        qcount + "&last_q_id="+lastQIDVal+ "&response_option="+ respOption+ "&resp_session_id="+ obj.resp_sessId+
          "&subject_id="+ {{subject_id}}+"&btn="+btn+"&student_id={{student_id}}",
        type: "get",
        data: '', 
        success: function (response) {
          $('#submit').prop('disabled',false);
        $('#next').prop('disabled',false);
          if(response!='0'){
          $("#questionSection").html(response);
          }
          if(num=='q'){
            console.log('inside success of num q ');
            // if(btn=='Start'){
              if (tempCountVar != (questionListSize-1)) {
          c = (parseInt(c) + 1);
              }
            // }
          console.log('in success c:'+c);
          }
          console.log('Temp count var:'+tempCountVar);
          // if (tempCountVar == questionListSize) {
          //   //$("#skipButton").hide();
          //   //$("#startAndNextBTN").hide();
          // } 
          // else if(tempCountVar > questionListSize){
          //   $("#skipButton").hide();
          //   $('#submit').hide();
          //   $("#startAndNextBTN").hide();
          //   $('#clear').hide();
          //   $('#save').hide();
          //   $('#next').hide();
          // }
          // else {
          //   console.log('inside else ');
            // $("#startAndNextBTN").attr('value', 'Submit and Next');
            // $("#startAndNextBTN").attr('class', 'btn btn-primary left green');
            // $("#skipButton").show();
            // Additional btn
            // $('#submit').show();
            // $('#clear').show();
            // $('#save').show();
            // $('#save').attr('disabled',true);
            // $('#next').show();
            // $('#next').attr('disabled',true);
            // End
          // }
          // location.reload(true);
        },
        error: function (xhr) {
          window.alert("error occurred while loading question");
        }
      });
    } 
  };
  //$('#submitAndFinishBTN').click(function(){
  //  var class_val = $('#class_val_ip').val();
  //  console.log('This is the class_val in js: ' + class_val);
  //  var section = $('#section_ip').val();
  //  console.log('This is the section: ' + section);
  //  questionIDListStr  = JSON.stringify(questionIDListJS);     
  //  var resp_session_id={{resp_session_id}};
  //    $.ajax({
  //      url: "/feedbackReport?resp_session_id="+resp_session_id,
  //      type: "get",
  //      data: "",
  //      success: function(response) {
  //        if (response!="NA"){
  //        $("#feedbackReportDiv").html(response);
  //        }
  //        else{
  //          $("#feedbackReportDiv").html('<span class="grey-text text-lighten-1"> <p style="font-size: 36px;">No feedback data for this session.</p></span>');
  //        }    
  //        $("#feedbackReportDiv").show(); 
  //        $("#feedbackQuestionDiv").hide();
  //        $("#video-field").hide();                    
  //        $("#ResponseList").hide();                    
  //        $("#allResponsesSubmitted").show(); 
  //        $("#completeClassBTN").show();                     
  //      },
  //      error: function(xhr) {
  //        window.alert("error occurred while submittig data");
  //      }
  //    });              
  //});
</script>
<script src="../static/js/qrReader_zbar-main.js"></script>
<script type="text/javascript" src="../static/js/zbar-processor.js"></script>

{%endblock%}