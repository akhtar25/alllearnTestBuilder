{%extends "layout.html"%} {%block content%}
<div class="container">
                <div class="hold-transition skin-blue sidebar-mini">    
                                <div id="sidebarDiv" >   
                                    <div class="main-sidebar" style="margin-top:15px;">
                                        <section class="sidebar">                     
                                              <ul class="sidebar-menu table-responsive" data-widget="tree">
                                                  {% for singleClass in distinctClasses %}
                                                         <li class="treeview">
                                                           <a href="#">
                                                             <i class="glyphicon glyphicon-education"></i>
                                                             <span>Class {{singleClass[0]}}</span>
                                                             <span class="pull-right-container">
                                                               <span class="label label-primary pull-right">{{singleClass[1]}}</span>
                                                             </span>
                                                           </a>                                                      
                                                           <ul class="treeview-menu">                            
                                                              {% for classsection in classsections %}
                                                                 {% if classsection.class_val==singleClass[0] %}
                                                             <li>
                                                                <a href="{{ url_for('resultUpload',class_val=classsection.class_val, section=classsection.section) }}"> 
                                                                <i class="fa fa-circle-o"></i> Section {{classsection.section}}</a></li>                              
                                                              {% endif %}
                                                             {% endfor %}
                                                           </ul>                                                      
                                                         </li>
                                                         {% endfor %}                
                                         <ul>                  
                                        </section>
                                        <!-- /.sidebar -->
                                    </div>
                                </div>
        <!-------------------------------------------------------------------------------------------  -->
        <div class="content-wrapper" style="background-color: white;">
        <section class="content">
        
        

        <!-- Start Result Table -->

        {% if student_list %}

        <div class="box">
        <div class="box-header">
        <h3 class="box-title">Result Upload</h3><span style="padding-left: 10px;">    Class: {{qclass_val}} | Section: {{qsection}}</span>                              
        </div>
        <div class="right"><a href="{{url_for('resultUploadHistory')}}">Upload History</a></div><br/>
        <p class="right" style="margin-bottom: 0px;">* Please enter -1 for absent students</p>
        <div class="card id" id="result_table" style="margin-top: 24px;">
        <div class="card-body">
          <div id="table" class="table-editable" style="overflow-y: auto;height: 466px;overflow-x: auto;">
            <table class="table table-bordered table-responsive-md table-striped text-center">
                    <thead>
                            <tr>
                                <th scope="col" style="width: 200px;">
                                        <!-- <a class="btn-floating btn-large waves-effect waves-light blue" id="addColumn" style="margin-bottom: 20px;"><i class="material-icons">add</i></a><br/> -->
                                                
                                        Student Name
                                </th>
                                
                                
                                
                                <th scope="col" style='width: 200px;'>
                                        <div style="display:flex;margin-bottom: 20px;">
                                                <select class="browser-default selectSubID" style="float: left;margin-right: 10px;" name="subjectIds" id="subjectIds">
                                                  <option value="" disabled selected style="font-size:11px;">Choose Subject</option>
                                                  {% for subject in subject_name %}
                                                  <option value="{{subject[1]}}">{{subject[0]}}</option>
                                                  {% endfor %}
                                                </select> 
                                                
                                                <select class="browser-default testtype" style="float: right;" name="testtype" id="testtype">
                                                  <option value="" disabled selected style="font-size:11px;">Choose Test type</option>
                                                  {% for test in test_type %}
                                                  <option value="{{test.msg_id}}">{{test.description}}</option>
                                                  {% endfor %}
                                                </select> 
                                        </div>
                                                <div style="display: flex;margin-bottom: 28px;">
                                                <input type="number" id="Tmarks" name="Tmarks" placeholder="total marks" value="Tmarks" style="width: 220px;font-size: 14px;">
                                                <input type="date" name="testdate" id="testdate" style="margin-left: 10px;width: 210px;float: right;">     
                                        </div> 
                                        <select class="browser-default fa" id="test_id">
                                                        <option value="" disabled selected style="font-size:11px;">Test papers</option>
                                                        <option value="" style="font-size:11px;">NA</option>
                                                        {% for test in test_details %}
                                                        <div>
                                                        <option value="{{test.test_id}}">{{test.test_id}} -- >      {{test.date_of_creation.date()}}</option>
                                                        <a href="{{test.test_paper_link}}"><i class="fa fa-eye"></i></a>
                                                        </div>
                                                        {% endfor %}
                                                      </select>
                                                      
                                </th>
                               
                        
                             </tr>

                    </thead>
                    <tbody>
                                
                            {% for student in student_list %}
                                <tr>
                                    <td> {{student.full_name }} </td>
                                    <td><div class="container" style="width:100px;"><input type="number" id="marks" class="marks" name="marks" max="100" min="-1" ></div>
                                   </td>  
                                </tr>
                            {% endfor %}
                    </tbody>
            </table>
        </div>
        </div>
        </div>
      </div> 
      <!-- Start -->

      <!-- End -->
      <p style="padding-left:395px;"><input type="button" onclick="M.toast({html: 'Result Successfully Uploaded !!!'})" class="btn waves-light green lighten-1 white-text" id="upload" name="upload" value="upload" style="width:100px;height: 35px;"></p>
      </form>
      {% endif %}
        <!-- End Result Upload Table -->
        <div class="fixed-action-btn">
                        <a class="btn-floating btn-large blue" style="font-size: 12px;">Column
                          <!-- <i class="large material-icons">mode_edit</i> -->
                        </a>
                        <ul>
                          <li><a class="btn-floating btn-large waves-effect waves-light blue" id="addColumn" style="font-size: 12px;"><i class="material-icons">add</i></a></li>
                        </ul>
                      </div>
</section>
</div>
</div>  
</div> 
      <link rel="stylesheet" href="../static/css/skins/_all-skins.min.css">
      <script>
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();
        if(dd<10){
                dd='0'+dd
        } 
        if(mm<10){
                mm='0'+mm
        } 

        

        today = yyyy+'-'+mm+'-'+dd;
        document.getElementById("testdate").setAttribute("max", today);

      
        $(document).ready(function(){
    $('.fixed-action-btn').floatingActionButton();
  });
//         document.addEventListener('DOMContentLoaded', function() {
//     var elems = document.querySelectorAll('.fixed-action-btn');
//     var instances = M.FloatingActionButton.init(elems, {
//       direction: 'left'
//     });
//   });
        var count = 1;


        $('#upload').click(function(){
        console.log('count of upload;'+count);
        var subject_id = $(".selectSubID").val();
        var test_type = $(".testtype").val();
                var class_val = '{{qclass_val}}';
                var class_section = '{{qsection}}';
                var marks = $(".marks").map(function(){
                        return this.value;
                }).get();
                console.log('marks length:'+marks.length);
                for(var i=0;i<marks.length;i++){
                        console.log('Marks of Subject are:'+marks[i]);
                }
                console.log('Inside Marks Test');
                var testdate = $('#testdate').val();
                var Tmarks = $('#Tmarks').val();
                var testId = $('#test_id').val();
                var data = "";
                $.ajax({
                        url: "/uploadMarks?class_val="+ class_val + "&class_section="+class_section+"&subject_id="+subject_id+"&marks="+marks+"&testdate="+testdate+"&Tmarks="+Tmarks+"&testId="+testId+"&test_type="+test_type,
                        type: "get",
                        data: data,
                        success: function(response) {       
                             window.location.reload(); 
                        },
                        error: function(xhr) {
                          window.alert("error occurred while loading question");
                        }
                      });       
        count = count +1;
       if(num!=0){
               var n = 1;
               for(var i=0;i<num;i++){
                
                var subject_id = $(".selectSubID"+n).val();
                console.log("Subjects:"+subject_id);
                var class_val = '{{qclass_val}}';
                var class_section = '{{qsection}}';
                var test_type = $(".testtype"+n).val(); 
                var marks = $(".marks"+n).map(function(){
                        return this.value;
                }).get();
                var testdate = $('#testdate'+n).val();
                var Tmarks = $('#Tmarks'+n).val();
                var testId = $('#test_id'+n).val();
                var data = "";
                $.ajax({
                        url: "/uploadMarks?class_val="+ class_val + "&class_section="+class_section+"&subject_id="+subject_id+"&marks="+marks+"&testdate="+testdate+"&Tmarks="+Tmarks+"&testId="+testId+"&test_type="+test_type,
                        type: "get",
                        data: data,
                        success: function(response) {       
                             window.location.reload(); 
                        },
                        error: function(xhr) {
                          window.alert("error occurred while loading question");
                        }
                      }); 
                n=n+1;
               }
               console.log('Yes');
       }else{
               console.log('No');
       }
        });

        

  $(document).ready(function(){
    $('select').formSelect();
  });
 
//   $('#addColumn').click(function(){
//         count = count +1;
//   });
        
        var num = 0;
        $("#addColumn").click(function () {
                num=num+1;
        console.log('count of add Column function:'+num);
	$("tr:first").append("<th scope='col' style='width: 200px;'><div style='display:flex;margin-bottom: 20px;'><select class='browser-default selectSubID"+num+"' style='float:left;margin-right:10px;'><option value='' disabled selected style='font-size:11px;'>Choose Subject</option> {% for subject in subject_name %}<option value='{{subject[1]}}'>{{subject[0]}}</option>{% endfor %} </select> <select class='browser-default testtype"+num+"' style='float: right;' name='testtype' id='testtype'><option value='' disabled selected style='font-size:11px;'>Choose Test type</option>{% for test in test_type %}<option value='{{test.msg_id}}'>{{test.description}}</option>{% endfor %}</select> </div><div style='margin-bottom: 10px;display:flex;'><input type='number' name='Tmarks' id='Tmarks"+num+"' placeholder='total marks' value='Tmarks' style='width: 220px;font-size: 14px;'><input type='date' name='testdate' id='testdate"+num+"' style='margin-left: 10px;width: 210px;float:right;'> </div>  <br/><select class='browser-default'  id='test_id"+num+"'><option value='' disabled selected style='font-size:11px;'>Test Papers</option><option value=''>Test Id --  Date of Creation </option>{% for test in test_details %}<option value='{{test.test_id}}'>{{test.test_id}} --  {{test.date_of_creation}} </option>{% endfor %} </select> </th>");
	$("tr:not(:first)").append("<td><div class='container' style='width:100px;'><input type='number' class='marks"+num+"' id='marks' name='marks' max='100' min='-1'></div></td>");
       
        });




    </script>
{%endblock%}