{%extends "layout.html"%} {%block content%}
<div class="container">
                <div class="hold-transition skin-blue sidebar-mini">    
                                <div id="sidebarDiv" >   
                                    <div class="main-sidebar" style="margin-top:15px;">
                                        <section class="sidebar">                     
                                              <ul class="sidebar-menu table-responsive" data-widget="tree">
                                                  {% for singleClass in distinctClasses %}
                                                         <li class="treeview">
                                                           <a href="#">
                                                             <i class="glyphicon glyphicon-education"></i>
                                                             <span>Class {{singleClass[0]}}</span>
                                                             <span class="pull-right-container">
                                                               <span class="label label-primary pull-right">{{singleClass[1]}}</span>
                                                             </span>
                                                           </a>                                                      
                                                           <ul class="treeview-menu">                            
                                                              {% for classsection in classsections %}
                                                                 {% if classsection.class_val==singleClass[0] %}
                                                             <li>
                                                                <a href="{{ url_for('resultUpload',class_val=classsection.class_val, section=classsection.section) }}"> 
                                                                <i class="fa fa-circle-o"></i> Section {{classsection.section}}</a></li>                              
                                                              {% endif %}
                                                             {% endfor %}
                                                           </ul>                                                      
                                                         </li>
                                                         {% endfor %}                
                                         <ul>                  
                                        </section>
                                        <!-- /.sidebar -->
                                    </div>
                                </div>
        <!-------------------------------------------------------------------------------------------  -->
        <div class="content-wrapper" style="background-color: white;">
        <section class="content">
        
        

        <!-- Start Result Table -->

        {% if student_list %}

        <div class="box">
        <div class="box-header">
        <h3 class="box-title">Result Upload</h3><span style="padding-left: 10px;">    Class: {{qclass_val}} | Section: {{qsection}}</span>                              
        </div>
        <div class="right"><a href="{{url_for('resultUploadHistory')}}">Upload History</a></div><br/>
        <p class="right" style="margin-bottom: 0px;">* Please enter -1 for absent students</p>
        <div class="card id" id="result_table" style="margin-top: 24px;">
        <div class="card-body">
          <div id="table" class="table-editable" style="overflow-y: auto;height: 466px;overflow-x: auto;">
            <table class="table table-bordered table-responsive-md table-striped text-center">
                    <thead>
                            <tr>
                                <th scope="col" style="width: 200px;">

                                        Student Name
                                </th>
                                <th><a class="btn-floating btn-large waves-effect waves-light blue" id="addColumn" style="margin-bottom: 20px;"><i class="material-icons">add</i></a><br/>
                                        Add Column
                                </th>
                                
                                <th scope="col" style='width: 200px;'>
                                                <select class="browser-default selectSubID" style="float: right;" name="subjectIds" id="subjectIds">
                                                  <option value="" disabled selected style="font-size:11px;">Choose Subject</option>
                                                  {% for subject in subject_name %}
                                                  <option value="{{subject[1]}}">{{subject[0]}}</option>
                                                  {% endfor %}
                                                </select> <br/>
                                                <div style="margin-top: 24px;text-align: center;display:flex;">
                                                <input type="number" id="Tmarks" name="Tmarks" placeholder="total marks" value="Tmarks" style="width: 120px;font-size: 14px;">
                                                <input type="date" name="testdate" id="testdate" style="margin-left: 10px;width: 200px;">     
                                        </div>  <br/>
                                        <select class="browser-default fa" id="test_id">
                                                        <option value="" disabled selected style="font-size:11px;">Test Id</option>
                                                        <option value="" style="font-size:11px;">NA</option>
                                                        {% for test in test_details %}
                                                        <div style="display:flex;">
                                                        <option value="{{test.test_id}}">{{test.test_id}} -- >      {{test.date_of_creation.date()}} <a href="#"><i class="fa fa-eye" aria-hidden="true"></i></a></option>
                                                        <a href="#"><i class="fa fa-eye"></i></a>
                                                        </div>
                                                        {% endfor %}
                                                      </select>
                                                      
                                </th>
                               
                        
                             </tr>

                    </thead>
                    <tbody>
                                
                            {% for student in student_list %}
                                <tr>
                                    <td> {{student.full_name }} </td>
                                    <td></td>
                                    <td><div class="container" style="width:100px;"><input type="number" id="marks{{loop.index}}" class="marks" name="marks{{loop.index}}" max="100" min="-1" ></div></td> 
                                    
                                </tr>
                            {% endfor %}
                    </tbody>
            </table>
        </div>
        </div>
        </div>
      </div> 
      <!-- Start -->

      <!-- End -->
      <p style="padding-left:395px;"><input type="button" class="btn waves-light green lighten-1 white-text" id="upload" name="upload" value="upload" style="width:100px;height: 35px;"></p>
      </form>
      {% endif %}
        <!-- End Result Upload Table -->
</section>
</div>
</div>  
</div> 
      <link rel="stylesheet" href="../static/css/skins/_all-skins.min.css">
      <script>
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();
        if(dd<10){
                dd='0'+dd
        } 
        if(mm<10){
                mm='0'+mm
        } 

        

        today = yyyy+'-'+mm+'-'+dd;
        document.getElementById("testdate").setAttribute("max", today);


       


        $('#upload').click(function(){
        var windeId = $('.selectSubID').map(function(){
                
                return this.value;
        }).get();
        for(var i=0;i<windeId.length;i++){
                var class_val = '{{qclass_val}}';
                var class_section = '{{qsection}}';
                
                
                
                {% for subject in subject_name %}
                // var list_marks = document.getElementsByClassName('marks{{loop.index}}').value;
                        console.log('SubjectId:'+windeId[i]+'No of Subjects:'+windeId.length);
                var subject_id = windeId[i];
                console.log('Subject Id : {{subject[1]}}' + ' from windeId' + windeId[i]);
                if('{{subject[1]}}'==windeId[i]){
                var marks = $('.marks{{loop.index}}').map(function(){
                        return this.value;
                }).get();
                for(var i=0;i<marks.length;i++){
                        console.log('Marks of '+'{{subject[0]}} '+'Subject are:'+marks[i]);
                }
                var testdate = $('#testdate').val();
                var Tmarks = $('#Tmarks').val();
                var testId = $('#test_id').val();
                var data = "";
                $.ajax({
                        url: "/uploadMarks?class_val="+ class_val + "&class_section="+class_section+"&subject_id="+subject_id+"&marks="+marks+"&testdate="+testdate+"&Tmarks="+Tmarks+"&testId="+testId,
                        type: "get",
                        data: data,
                        success: function(response) {       
                        //     window.location.reload(); 
                        },
                        error: function(xhr) {
                          window.alert("error occurred while loading question");
                        }
                      }); 
                      
                 }
                 {% endfor %}
                }
        
        });

        

  $(document).ready(function(){
    $('select').formSelect();
  });
        
        
  $("#addColumn").click(function () {
	$("tr:first").append("<th scope='col' style='width: 200px;'><select class='browser-default selectSubID' style='float:right;'><option value='' disabled selected style='font-size:11px;'>Choose Subject</option> {% for subject in subject_name %}<option value='{{subject[1]}}'>{{subject[0]}}</option>{% endfor %} </select> <br/><div style='margin-top: 24px;text-align: center;display:flex;'><input type='number' name='Tmarks' placeholder='total marks' value='Tmarks' style='width: 120px;font-size: 14px;'><input type='date' name='testdate' id='testdate' style='margin-left: 10px;width: 200px;'> </div>  <br/><select class='browser-default' ><option value='' disabled selected style='font-size:11px;'>Test Id</option><option value=''>Test Id --  Date of Creation </option>{% for test in test_details %}<option value='{{test.test_id}}'>{{test.test_id}} --  {{test.date_of_creation}} </option>{% endfor %} </select> </th>");
        
	$("tr:not(:first)").append("<td><div class='container' style='width:100px;'><input type='number' class='marks{{loop.index}}' id='marks' name='marks' max='100' min='-1'></div></td>");
    //$("tr:not(:first)").append("<td><input type='checkbox' />Sample Element</td>");
});




    </script>
{%endblock%}