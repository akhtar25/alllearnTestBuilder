{%extends "layout.html"%} {%block content%}
<div class="container">
        <h2>Result Upload</h2>
        <form action="" method="POST">
        {{ form.hidden_tag() }}
        <div class="form-group " style="padding-top:5px;">
                <div class="row">
                        <div class="col-sm-3">
                                <div style="width:250px;">
                                        {{ form.class_val.label(class='labelsize') }}
                                        <br>
                                        {% if form.class_val.errors %}
                                        {{ form.class_val(class="form-control form-control-lg is-invalid") }}
                                        <div class="invalid-feedback">
                                        {% for error in form.class_val.errors %}
                                         <span>{{ error }}</span>
                                        {% endfor %}
                                        </div>
                                        {% else %}
                                        {{ form.class_val(class='form-control') }}
                                        {% endif %}
                                </div>
                        </div>
                        <div class="col-sm-2">
                                <div style="width:150px;" >
                                                {{ form.section.label(class='labelsize') }}
                                                <div id='loader'style='display: none; float: right;'>
                                                                <img src='../static/images/spinner.gif' width='25px' height='25px'>
                                                                </div>
                                        <br>
                                                {% if form.section.errors %}
                                                {{ form.section(class="form-control form-control-lg is-invalid") }}
                                                <div class="invalid-feedback">
                                                {% for error in form.section.errors %}
                                                 <span>{{ error }}</span>
                                                {% endfor %}
                                        </div>
                                                {% else %}
                                                {{ form.section(class='form-control') }}
                                                {% endif %}                                                
                                </div>
                        </div>
                        <div class="col-sm-2">
                        <label class='labelsize' for='Date'>Date</label>
                        <input type="date" name='testdate' id='testdate'>
                        </div>
                        <div class="col-sm-3" style="padding-top:5px;display:none;"> 
                                        {{ form.subject_name.label(class='labelsize') }}
                                        <div id='loaderSubject'style='display: none; float: right;'>
                                                <img src='../static/images/spinner.gif' width='25px' height='25px'>
                                                </div>
                                        <br>
                                        {% if form.subject_name.errors %}
                                        {{ form.subject_name(class="form-control form-control-lg is-invalid") }}
                                        <div class="invalid-feedback">
                                        {% for error in form.subject_name.errors %}
                                         <span>{{ error }}</span>
                                        {% endfor %}
                                </div>
                                        {% else %}
                                        {{ form.subject_name(class='form-control') }}
                                        {% endif %}
                        </div>  
                        <div class="col-sm-2" style="padding-top:5px;"> 

                                        {{ form.test_type.label(class='labelsize') }}
                                        <br>
                                        {% if form.test_type.errors %}
                                        {{ form.test_type(class="form-control form-control-lg is-invalid") }}
                                        <div class="invalid-feedback">
                                        {% for error in form.test_type.errors %}
                                         <span>{{ error }}</span>
                                        {% endfor %}
                                        </div>
                                        {% else %}
                                        {{ form.test_type(class='form-control') }}
                                        {% endif %}
                        </div>  
                </div>
                <p><button class="btn waves-light green lighten-1 white-text" type="submit">Submit</button></p>
                <div class="right"><a href="{{url_for('resultUploadHistory')}}">Upload History</a></div>
            </div>
        </form>
      </div>
      
{% if student_list %}
<div class="container" style="float:right;margin-top: 20px;">

<p class="right" style="margin-bottom: 0px;">* Please enter -1 for absent students</p>
</div>
<div class="card id" id="result_table">
        <h3 class="card-header text-center font-weight-bold text-uppercase py-4">Class {{ class_value }}<sup style="text-transform: lowercase;">th</sup> | {{ test_type }} [{{ test_date }}] </h3>
        <div class="card-body">
          <div id="table" class="table-editable">
            <table class="table table-bordered table-responsive-md table-striped text-center">
                    <thead>
                            <tr>
                                <th scope="col">Student Name</th>
                                
                                {% for subject in subject_name %}
                                <th scope="col">
                                                <p style="margin-bottom: 0px;">
                                                        <label>
                                                        <input type="checkbox" id="marksCheckBox{{loop.index}}" name="selectSubject"/>
                                                        <span>{{ subject[0]}}</span><br/>
                                                        <!-- <form action="" method="POST" name="form-upload" style="width: 130px;margin-right: -20px;">
                                                        {{ form1.hidden_tag() }} -->
                                                        <input type="hidden" name="upload_form" value="Upload">
                                                        <div class="marksbox">
                                                        <p class="right" style="margin-bottom: 0px;width: 112px;font-size: 13px;display: flex;margin-right: 6px;"><span style="width: 70px;">Total Marks:</span><input id="Tmarks{{loop.index}}" type="number" max="100" min="-1" name="marks" disabled></p><br/>
                                                        <!-- <label class='labelsize' for='Date'>Date</label> -->
                                                        <input type="date" name='testdate' id='testdate{{loop.index}}' style="font-size: 13px;width: 127px;margin-bottom: 0px;" disabled>
                                                        </div>
                                                        </label>
                                                </p>   
                                </th>
                                {% endfor %}
                                <!-- <th scope="col">Marks Scored</th> -->
                            </tr>
                    </thead>
                    <tbody>
                        <form action="" method="POST" name="form-upload">
                                {{ form1.hidden_tag() }}
                                <input type="hidden" name="upload_form" value="Upload">
                                
                            {% for student in student_list %}
                                <tr>
                                    <td> {{student.full_name }} </td>
                                    {% for subject in subject_name %}
                                    <td><div class="container" style="width:100px;"><input type="number" id="marks{{loop.index}}" name="marks{{loop.index}}" max="100" min="-1" disabled></div></td> 
                                     {% endfor %}
                                </tr>
                            {% endfor %}
                    </tbody>
            </table>
        </div>
        </div>
      </div>
      <p style="padding-left:575px;">{{ form1.upload(class="btn waves-light green lighten-1 white-text") }}</p>
      </form>
      {% endif %}
      <script>
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();
        if(dd<10){
                dd='0'+dd
        } 
        if(mm<10){
                mm='0'+mm
        } 

        

        today = yyyy+'-'+mm+'-'+dd;
        document.getElementById("testdate").setAttribute("max", today);

        // $('#marksCheckBox').click(function(){
        //         console.log('Inside Marks checkbox');
        //         if ($("input[type=checkbox]").prop(":checked")) { 
        //              console.log('Check box is checked');
                    
        //         }
        // });

        $(document).ready(function(){
        
        var id = '';
        var inputId = '';
         {% for subject in subject_name %}
        $('#marksCheckBox{{loop.index}}').click(function(){
                console.log('Inside checkbox');
            if($(this).prop("checked") == true){
                console.log("Checkbox is checked.");
                
                $('#Tmarks{{loop.index}}').removeAttr("disabled");
                $('#testdate{{loop.index}}').removeAttr("disabled");
                $('[name="marks{{loop.index}}"]').removeAttr("disabled");
            }
            else if($(this).prop("checked") == false){
                console.log("Checkbox is unchecked.");
                $('#Tmarks{{loop.index}}').attr("disabled",true);
                $('#testdate{{loop.index}}').attr("disabled",true);
                $('[name="marks{{loop.index}}"]').attr("disabled",true);
            }
        });


        {% endfor %}
        });
        
    </script>
{%endblock%}