{%extends "layout.html"%} {%block content%}
<div class="container container-color" >
<div class="app-page-title">
  <div class="page-title-wrapper">
    <div class="page-title-heading"> 
      <div class="page-title-icon">
        <i class="fas fa-user-cog "></i>  
      </div> 
      <div class="head">Admin Dashboard</div>
    </div>
  </div>
</div>
<div class="row">
  <!-- For Total numbers of schools -->
    <div class="col-md-4 col-xl-4"> 
      <div class="card mb-3 widget-content bg-midnight-bloom">
        <div class="widget-content-wrapper text-white">
          <div class="widget-content-left">
            <div class="widget-heading">
              Schools
            </div>
            <div class="widget-subheading">
              On board 
            </div>
          </div>
          <div class="widget-content-right">
            <div class="widget-numbers text-white" style="font-size:26px;">
              <span>{{school_count[0]}}</span>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    <!-- For total numbers of teachers -->

    <div class="col-md-4 col-xl-4">
        <div class="card mb-3 widget-content bg-arielle-smile">
          <div class="widget-content-wrapper text-white">
            <div class="widget-content-left">
              <div class="widget-heading">
                Teachers
              </div>
              <div class="widget-subheading">
                across all schools 
              </div>
            </div>
            <div class="widget-content-right">
              <div class="widget-numbers text-white" style="font-size:26px;">
                <span>{{teacher_count[0]}}</span>
              </div>
            </div>
          </div>
          
        </div>
      </div>

      <!-- for total numbers of students -->
      <div class="col-md-4 col-xl-4">
          <div class="card mb-3 widget-content bg-grow-early">
            <div class="widget-content-wrapper text-white">
              <div class="widget-content-left">
                <div class="widget-heading">
                  Students
                </div>
                <div class="widget-subheading">
                  across all schools 
                </div>
              </div>
              <div class="widget-content-right">
                <div class="widget-numbers text-white" style="font-size:26px;">
                  <span>{{student_count[0]}}</span>
                </div>
              </div>
            </div>
            
          </div>
        </div>
  </div>


<div class="row">
  <div class="col-md-4 col-lg-4">
    <div class="mb-3 card">
      <div class="card-header-tab card-header">
        <div class="card-header-title">
          <i class="header-icon lnr-rocket icon-gradient bg-tempting-azure">
          </i>Schools  
        </div>
      </div>

      <div class="tab-content" style="overflow-y: auto;height: 259px;">
        <ul class="collapsible" style="border: 0px;margin: 0px;">
          {% for school in schoolDetails %}
          <li>
            <div class="collapsible-header" title="Registered Schools" style="padding: 0px;">
                <i class="fas fa-school" style="margin-top: 10px;margin-left: 10px;"></i>
              <h4 style="font-size:15px;">{{school.school_name}}</h4>

          </div>
          {% for teacher in teacherDetails %}
          {% if teacher.school_id==school.school_id %}
          <div class="collapsible-body">
              <label for="TeacherName" style="padding: 0px;color: black;margin-left: 10px;">{{teacher.teacher_name}}</label>
              {% if school.school_admin==teacher.teacher_id %}
              <p style="font-size: 30px;float:right;margin-right: 10px;color:green;"><i class="fas fa-user-cog"></i></p>
              {% else %}
              <div id="{{teacher.teacher_id}}">
              <a class="waves-effect waves-light btn grantAccessBTNCLass" name="{{school.school_id}}" id="{{teacher.teacher_id}}" style="font-size: 11px;float:right;margin-right: 10px;margin-top: -30px;padding-top: 10px;">Set for Admin</a>
              </div>
              {% endif %}
            </div>
          {% endif %}
          {% endfor %}
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6 col-xl-6">
          <div class="card mb-3 widget-content">
            <div class="widget-content-wrapper">
              <div class="widget-content-left">
                <div class="widget-heading">
                  Registered Users
                </div>
                <div class="widget-subheading">
                  total registered users of the system 
                </div>
              </div>
              <div class="widget-content-right">
                <div class="widget-numbers text-success" style="font-size:26px;">
                  <span>{{user_count[0]}}</span>
                </div>
              </div>
            </div>
            
          </div>
        </div>
    <div class="col-md-6 col-xl-6">
          <div class="card mb-3 widget-content">
            <div class="widget-content-wrapper">
              <div class="widget-content-left">
                <div class="widget-heading">
                  New Users
                </div>
                <div class="widget-subheading">
                 total registered users in last one month 
                </div>
              </div>
              <div class="widget-content-right">
                <div class="widget-numbers text-danger" style="font-size:26px;">
                  <span>{{min_user_count[0]}}</span>
                </div>
              </div>
            </div>
            
          </div>
        </div>
</div>


<div class="row">
  <div class="col-md-6 col-lg-6">
    <div class="card mb-3 widget-content">
      <div class="card-header-tab card-header" style="opacity:0.8">
        <!-- <div class="card-header-title"> -->
        <div class="widget-content-left">
          User Types  
          </div>
          <div class="widget-content-right">
            User Count
          </div>
        <!-- </div> -->
      </div>
      <div class="tab-content" style="overflow-y: auto;height: 155px;">
        <div class="widget-content widget-content">
        <ul>
            {% for userType in user_type_count %}
            <li style="display:flex;">
              <div class="widget-content-left" style="font-size:15px;font-weight:600;opacity:0.5;">
                  {{userType.description}}
              </div>
              <div class="widget-content-right" style="margin-right: 10px;">
                <div class="widget-numbers text-count" style="font-size:15px;">
                  <span>{{userType.user_count}}</span>
                </div>
              </div>
              </li>
              {% endfor %}
        </ul>
            </div>
      </div>
    </div>
  </div>
</div>

<div class="row">

<!-- % of increment in Schools -->
  <div class="col-md-4 col-lg-4">
    <div class="card-shadow-danger mb-3 widget-chart widget-chart2 text-left card">
      <div class="widget-content">
        <div class="widget-content-outer">
          <div class="widget-content-wrapper">
            <div class="widget-content-left pr-2 fsize-1">
              <div class="widget-numbers mt-0 fsize-3 text-danger">
                {{perSchool}}%
              </div>
            </div>
            <div class="widget-content-right w-100">
              <div class="progress-bar-xs progress">
                <div class="progress-bar bg-danger" role="progressbar" aria-valuenow="{{perSchool}}" aria-valuemin="0" aria-valuemax="100" style="width:{{perSchool}}%"></div>
              </div>
            </div>
          </div>
          <div class="widget-content-left fsize-1">
            <div class="text-muted opacity-6" style="font-size:15px;">
              Increment % of Schools from last month
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<!-- % of increment in teachers -->

  <div class="col-md-4 col-lg-4">
    <div class="card-shadow-danger mb-3 widget-chart widget-chart2 text-left card">
      <div class="widget-content">
        <div class="widget-content-outer">
          <div class="widget-content-wrapper">
            <div class="widget-content-left pr-2 fsize-1">
              <div class="widget-numbers mt-0 fsize-3 text-success">
                {{perTeacher}}%
              </div>
            </div>
            <div class="widget-content-right w-100">
              <div class="progress-bar-xs progress">
                <div class="progress-bar bg-success" role="progressbar" aria-valuenow="54" aria-valuemin="0" aria-valuemax="100" style="width:{{perTeacher}}%"></div>
              </div>
            </div>
          </div>
          <div class="widget-content-left fsize-1">
            <div class="text-muted opacity-6" style="font-size:15px;">
              Increment % of Teachers from last month
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- % of increment in Students -->

  <div class="col-md-4 col-lg-4">
    <div class="card-shadow-danger mb-3 widget-chart widget-chart2 text-left card">
      <div class="widget-content">
        <div class="widget-content-outer">
          <div class="widget-content-wrapper">
            <div class="widget-content-left pr-2 fsize-1">
              <div class="widget-numbers mt-0 fsize-3 text-info">
                {{perStudent}}%
              </div>
            </div>
            <div class="widget-content-right w-100">
              <div class="progress-bar-xs progress">
                <div class="progress-bar bg-info" role="progressbar" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100" style="width:{{perStudent}}%"></div>
              </div>
            </div>
          </div>
          <div class="widget-content-left fsize-1">
            <div class="text-muted opacity-6" style="font-size:15px;">
              Increment % of Students from last month
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

  <!-- <div class="row">
    <div class="col s12 m7" style="margin-left: 200px;">
      <div class="card">
        <div class="card-image">
          <span class="card-title">Card Title</span>
        </div>
        <div class="card-content">
            <p>Number of Registered teahcers: {{count}}</p>
        </div>
        <div class="card-action">
            <p>Number of Registered Users in last 10 Days: {{number}}</p>
        </div>
      </div>
    </div>
  </div> -->
  <script>
    $(document).ready(function () {
    $('.collapsible').collapsible();
    $('.collapsible-body').css('padding',"0");
  });

  $('.grantAccessBTNCLass').click(function(){
                //$('#loaderDiv').show();
                //$('#classTrackerDiv').hide();    
                console.log("Granting access");
                
                var school_id = $(this).attr('name');
                var teacher_id = $(this).attr('id');
                console.log(teacher_id);
                var data="";
                $.ajax({
                  url: "/grantSchoolAdminAccess?teacher_id="+ teacher_id+"&school_id="+school_id,
                  type: "get",
                  data: data,
                  success: function(response) {  
                     var id = '#'+ teacher_id;
                        $(id).html("<p style='green-text;float: right;margin-top: -25px;margin-right: 10px;color: green;font-size: 28px;'><i class='far fa-check-circle'></i></p>"); 
                        console.log('Inside success');       
                  },
                  error: function(xhr) {
                    window.alert("error occurred while granting access for school admin");
                  }
                });      
                       
            });           
  </script>

  {%endblock%}