{%extends "layout.html"%} 
{%block content%}
<div class="container">
    <h3>Attendance</h3>    

    <form action="" method="POST">
        {{ form.hidden_tag() }}
      
        <div class="form-group " style="padding-top:5px;">
                <div class="row">
                        <div class="col-sm-3">
                                <div style="width:250px;">
                                        {{ form.class_val.label(class='labelsize') }}
                                        <br>
                                        {% if form.class_val.errors %}
                                        {{ form.class_val(class="form-control form-control-lg is-invalid") }}
                                        <div class="invalid-feedback">
                                        {% for error in form.class_val.errors %}
                                         <span>{{ error }}</span>
                                        {% endfor %}
                                        </div>
                                        {% else %}
                                        {{ form.class_val(class='form-control') }}
                                        {% endif %}
                                </div>
                        </div>
                        <div class="col-sm-2">
                                <div style="width:150px;" >
                                                {{ form.section.label(class='labelsize') }}
                                                <div id='loader'style='display: none; float: right;'>
                                                        <img src='../static/images/spinner.gif' width='25px' height='25px'>
                                        </div>

                                        <br>
                                                {% if form.section.errors %}
                                                {{ form.section(class="form-control form-control-lg is-invalid") }}
                                                <div class="invalid-feedback">
                                                {% for error in form.section.errors %}
                                                 <span>{{ error }}</span>
                                                {% endfor %}
                                                </div>
                                                {% else %}
                                                {{ form.section(class='form-control') }}
                                                {% endif %}

                                               
                                </div>
                        </div>
                        <p style="margin-top:23px; padding-left:3px;"><button class="btn waves-light green lighten-1 white-text" type="submit">Submit</button></p>
                </div>
               
                    
        </div>
            
    </form>
</div>

{% if student_list %}

<div class="card id" id="result_table">
        <h3 class="card-header text-center font-weight-bold text-uppercase py-4">Attendance</h3>
        <div class="card-body">
          <div id="table" class="table-editable">
            <table class="table table-bordered table-responsive-md table-striped text-center">
                    <thead>
                            <tr>
                                <th scope="col">Student Name</th>
                                {% for i in range(-7,0,1) %}
                                <th scope="col">{{ i }}</th>
                                {% endfor %}
                                <td>today</td>
                            </tr>
                    </thead>
                    <tbody>
                        <form action="" method="POST" name="form-upload">
                                {{ form1.hidden_tag() }}
                                <input type="hidden" name="upload_form" value="Upload">
                                
                            {% for student in student_list %}
                                <tr>
                                    <td> {{student.student_name }} </td>
                                    {% for j in range(-7,0,1) %}
                                   
                                    <td>A</td>
                                    {% endfor %}
                                  <td><p>
                                        <label>
                                            <input id="absent_marker" name="absent_marker" type="checkbox">
                                            <span>Absent</span>
                                        </label>
                                    </p>    </td>
                                  
                                </tr>
                            {% endfor %}
                    </tbody>

            </table>
        
        </div>
        </div>
        
      </div>
      
      <p style="padding-left:575px;">{{ form1.upload(class="btn waves-light green lighten-1 white-text") }}</p>

      </form>

      

      {% endif %}




<script>
        var class_select = document.getElementById("class_val");
        var section_select = document.getElementById("section");
        class_select.onchange = function()  {
             
            class_val = class_select.value;
            $("#loader").show();
            
            fetch('/resultUpload/' + class_val).then(function(response) {
                response.json().then(function(data) {
                        $("#loader").hide();    
                        var optionHTML = '';
                        for (var section of data.sections) {
                        optionHTML += '<option value="' + section.section_val + '">' + section.section_val + '</option>';
                    }
                    section_select.innerHTML = optionHTML;
                })
                
            });
        }
    </script>

{%endblock%}